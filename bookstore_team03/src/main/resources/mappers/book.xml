<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- book.xml -->

<mapper namespace="book">


	<select id="totalList" resultType="java.util.Map">
		select * from book
	</select>

	<select id="comicList" resultType="kr.co.itwill.book.BookDTO">
		select *
		from book
		where book_mainname='만화'
	</select>

	<select id="list" resultType="java.util.Map">
		select *
		from book AA join writer BB
	  	on AA.book_writerno=BB.writer_no;
	</select>

	<select id="bestList" resultType="java.util.Map">
		SELECT isbn, book_name, book_pub, book_writerno, book_price, book_stock, book_pubdate, book_page, book_count, tag_no1, tag_no2, tag_no3, book_imgoriname, book_imgname, book_imgpath, book_imgsize, book_mainname, book_subname, book_content
		FROM book
		ORDER BY book_count DESC
	</select>

	<select id="reviewCount" parameterType="kr.co.itwill.review.ReviewDTO" resultType="int">
		select count(*) as 상품후기
		from review
		where isbn=${isbn}
	</select>

	<insert id="insert" parameterType="java.util.Map">
		insert into book(isbn, book_name, book_pub, book_writerno, book_price, book_stock, book_pubdate, book_page, tag_no1, book_mainname, book_subname, book_content, book_imgname, book_imgsize)
		values (#{isbn}, #{book_name}, #{book_pub}, #{book_writerno}, #{book_price}, #{book_stock}, #{book_pubdate}, #{book_page}, #{tag_no1}, #{book_mainname}, #{book_subname}, #{book_content}, #{book_imgname}, #{book_imgsize})
	</insert>

	<select id="search" parameterType="String" resultType="java.util.Map">
		select *
		from book
		where book_name LIKE #{keyword}
		order by book_name
	</select>

	<select id="detail" resultType="java.util.Map" parameterType="String">
		select *
		from book AA join writer BB
						  on AA.book_writerno=BB.writer_no
		where isbn=#{isbn}
	</select>
	
	<select id="filename" resultType="String" parameterType="String">
        SELECT book_imgname
        FROM book
        WHERE isbn=#{isbn}
    </select>

	<delete id="delete" parameterType="String">
		delete from book
		where isbn=#{isbn}
	</delete>

	<update id="update" parameterType="java.util.Map">
		update book
		set book_name=#{book_name}
		  ,book_pub=#{book_pub}, book_writerno=#{book_writerno}
		  ,book_price=#{book_price}, book_stock=#{book_stock}
		  ,book_pubdate=#{book_pubdate}, book_page=#{book_page}
		  ,tag_no1=#{tag_no1}, book_mainname=#{book_mainname}
		  ,book_subname=#{book_subname}, book_content=#{book_content}
		  ,book_imgname=#{book_imgname}, book_imgsize=#{book_imgsize}
		where isbn=#{isbn}
	</update>

	<update id="count" parameterType="String">
		update book
		set book_count=book_count+1
		where isbn=#{isbn}
	</update>

	<select id="score" resultType="double" parameterType="String">
		select ifnull(sum(review_score)/count(*), 0)
		from review
		where isbn=#{isbn}
	</select>

	<!-- 페이징을 적용한 게시물 리스트 조회 -->
	<select id="listPaging" resultType="java.util.Map">
		SELECT *
		FROM book
		ORDER BY book_name DESC
		LIMIT #{start}, #{end}
	</select>

	<select id="listCount" resultType="int">
		SELECT COUNT(*) FROM book;
	</select>

	<select id="choiceTable" resultType="int" parameterType="java.util.Map">
		select count(*)
		from choice
		where member_id=#{member_id} and isbn=#{isbn}
	</select>


</mapper>     




